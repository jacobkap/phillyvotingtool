<!DOCTYPE html>
<html lang="en">

<head>
  <title>Philly Election Tool</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.8.5/chosen.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.8.5/chosen.jquery.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.9.1/underscore-min.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ==" crossorigin="" />
  <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js" integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw==" crossorigin=""></script>
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/dt/dt-1.10.16/b-1.5.1/b-html5-1.5.1/fc-3.2.4/r-2.2.1/datatables.min.css" />
  <script type="text/javascript" src="https://cdn.datatables.net/v/dt/dt-1.10.16/b-1.5.1/b-html5-1.5.1/fc-3.2.4/r-2.2.1/datatables.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/dygraph/2.1.0/dygraph.min.js"></script>

  <script src="js/utils.js"></script>
  <script src="js/data.js"></script>
  <script src="js/map_data.js"></script>
  <link rel="stylesheet" href="css/style.css" />
  <link rel="stylesheet" href="css/tabs.css" />
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  <script>
    $(function() {
      $("#tabs").tabs();
    });
  </script>

</head>

<body>

  <div id="tabs">
    <ul>
      <li><a href="#home_tab">Home</a></li>
      <li><a href="#results_tab">Election Results</a></li>
      <li><a href="#time_tab">When do People Vote?</a></li>
      <li><a href="#choices_tab">Choices per Office</a></li>
      <li><a href="#cand_combinations_tab">Candidate Combinations</a></li>
    </ul>

    <div id="home_tab">
      <p>Introduction to the site ...</p>
    </div>

    <div id="results_tab">
      <div class="sidenav">
        <h3>Select a ballot position:</h3>
        <select class="simple-select" id="results_ballot_position" onchange="updateChart('results')">
      <script>
      $.each(all_offices, function(val, text) {
              $('#results_ballot_position').append( new Option(text,val) );
          });
          $('#results_ballot_position').val(0);
      </script>
    </select>
        <br><br>
        <h3>Select a voting ward:</h3>
        <select class="simple-select" id="results_ward" onchange="updateChart('results')">
        <script>
      $.each(wards, function(val, text) {
              $('#results_ward').append( new Option(text,val) );
          });
          $('#results_ward').val(0);
          $('.simple-select').chosen();
            </script>
    </select>
        <br><br>
        <h3>Select a voting ward by clicking on the map</h3>
        <div id="results_map_div" class="leaflet_map"></div>
        <script>
          var results_map = L.map('results_map_div', {
            minZoom: 10
          }).setView([40, -75.1], 10);
          L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
            maxZoom: 18,
            id: 'mapbox.streets',
            accessToken: 'pk.eyJ1IjoiamtrYXBsYW4iLCJhIjoiY2lnOXAyaWZyMHNjZ3V5bHg4YTZieDczaSJ9.vSjaF4o2xaDFhNAv9Z2y7A'
          }).addTo(results_map);

          geojson = L.geoJson(wards_polygon, {
            onEachFeature: onEachFeature
          }).addTo(results_map);
        </script>
      </div>



      <div class="main">
        <canvas id="results_chart"></canvas>
      </div>
    </div>


    <div id="time_tab">
      <div class="sidenav">
        <h3>Select an Election:</h3>
        <select class="simple-select" id="time_election">
      <script>
      $.each(elections, function(val, text) {
              $('#time_election').append( new Option(text,val) );
          });
          $('#time_election').val(0);
      </script>
    </select>
        <br><br>
        <h3>Select a voting ward:</h3>
        <select class="simple-select" id="time_ward">
        <script>
      $.each(wards, function(val, text) {
              $('#time_ward').append( new Option(text,val) );
          });
          $('#time_ward').val(0);
          $('.simple-select').chosen();
            </script>
    </select>
        <br><br>
        <h3>Select a voting ward by clicking on the map</h3>
        <div id="time_map_div" class="leaflet_map"></div>
        <script>
          var time_map = L.map('time_map_div', {
            minZoom: 10
          }).setView([40, -75.1], 10);
          L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
            maxZoom: 18,
            id: 'mapbox.streets',
            accessToken: 'pk.eyJ1IjoiamtrYXBsYW4iLCJhIjoiY2lnOXAyaWZyMHNjZ3V5bHg4YTZieDczaSJ9.vSjaF4o2xaDFhNAv9Z2y7A'
          }).addTo(time_map);

          geojson = L.geoJson(wards_polygon, {
            onEachFeature: onEachFeature
          }).addTo(time_map);
        </script>
      </div>



      <div class="main">
        <canvas id="time_graph"></canvas>
      </div>
    </div>



    <div id="choices_tab">
      <div class="sidenav">
        <h3>Select a ballot position:</h3>
        <select class="simple-select" id="choices_ballot_position" onchange="updateChart('choices')">
      <script>

      $.each(mult_offices, function(val, text) {
              $('#choices_ballot_position').append( new Option(text,val) );
          });
          $('#choices_ballot_position').val(0);
      </script>
    </select>
        <br><br>
        <h3>Select a voting ward:</h3>
        <select class="simple-select" id="choices_ward" onchange="updateChart('choices')">
        <script>
      $.each(wards, function(val, text) {
              $('#choices_ward').append( new Option(text,val) );
          });
          $('#choices_ward').val(0);
          $('.simple-select').chosen();
            </script>
    </select>
        <br><br>
        <h3>Select a voting ward by clicking on the map</h3>
        <div id="choices_map_div" class="leaflet_map"></div>
        <script>
          var choices_map = L.map('choices_map_div', {
            minZoom: 10
          }).setView([40, -75.1], 10);
          L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
            maxZoom: 18,
            id: 'mapbox.streets',
            accessToken: 'pk.eyJ1IjoiamtrYXBsYW4iLCJhIjoiY2lnOXAyaWZyMHNjZ3V5bHg4YTZieDczaSJ9.vSjaF4o2xaDFhNAv9Z2y7A'
          }).addTo(choices_map);
          geojson = L.geoJson(wards_polygon, {
            onEachFeature: onEachFeature
          }).addTo(choices_map);
        </script>
      </div>



      <div class="main">
        <canvas id="choices_chart"></canvas>
      </div>
    </div>


    <div id="cand_combinations_tab">
      <div class="sidenav">
        <h3>Select a ballot position:</h3>
        <select class="simple-select" id="cand_comb_ballot_position" onchange="updateTable()">
      <script>
      $.each(mult_offices, function(val, text) {
              $('#cand_comb_ballot_position').append( new Option(text,val) );
          });
          $('#cand_comb_ballot_position').val(0);
      </script>
    </select>
        <br><br>
        <h3>Select a voting ward:</h3>
        <select class="simple-select" id="cand_comb_ward" onchange="updateTable()">
        <script>
      $.each(wards, function(val, text) {
              $('#cand_comb_ward').append( new Option(text,val) );
          });
          $('#cand_comb_ward').val(0);
          $('.simple-select').chosen();
            </script>
    </select>
        <br><br>
        <h3>Select a voting ward by clicking on the map</h3>
        <div id="cand_comb_map_div" class="leaflet_map"></div>
        <script>
          var cand_comb_map = L.map('cand_comb_map_div', {
            minZoom: 10
          }).setView([40, -75.1], 10);
          L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
            maxZoom: 18,
            id: 'mapbox.streets',
            accessToken: 'pk.eyJ1IjoiamtrYXBsYW4iLCJhIjoiY2lnOXAyaWZyMHNjZ3V5bHg4YTZieDczaSJ9.vSjaF4o2xaDFhNAv9Z2y7A'
          }).addTo(cand_comb_map);

          geojson = L.geoJson(wards_polygon, {
            onEachFeature: onEachFeature
          }).addTo(cand_comb_map);
        </script>
      </div>



      <div class="main">
        <h4 id = "table_title" align="center">title</h4>
        <br>
        <h5 id = "table_subtitle" align="center">subtitle</h5>
        <table id="table" class="display cell-border"></table>

        <script>
          cand_data = getData("cond_cand")
          table = makeTable("#table", cand_data, cand_data[0])
          title = all_offices[$('#cand_comb_ballot_position').val()];
          if (wards[$("#cand_comb_ward").val()] != "All") {
            title += ", Ward " + wards[$("#cand_comb_ward").val()];
          }
          subtitle = "Max number of selections: " + mult_offices_choices[$('#cand_comb_ballot_position').val()];
          $("#table_title").text(title);
          $("#table_subtitle").text(subtitle);

        </script>
      </div>
    </div>


  </div>
  <script>
    var results_data = getData("results")
    results_data = formatData(results_data, "results");
    title_text = results_data[1]
    results_data = results_data[0]

    var ctx_results = document.getElementById("results_chart").getContext('2d');
    results_chart = new Chart(ctx_results, {
      type: 'horizontalBar',
      data: results_data,
      options: {
        legend: {
          display: false
        },
        title: {
          display: true,
          position: 'top',
          text: title_text,
          fontSize: 14
        },
        scales: {
          yAxes: [{
            ticks: {
              beginAtZero: true
            }
          }]
        },
        tooltips: {
          enabled: true,
          mode: 'single',
          callbacks: {
            label: function(tooltipItems, data) {
              return ' Votes: ' + tooltipItems.xLabel;
            }
          }
        }
      }
    });

    var choices_data = getData("choices")
    choices_data = formatData(choices_data, "choices");
    title_text = choices_data[1]
    choices_data = choices_data[0]

    var ctx_choices = document.getElementById("choices_chart").getContext('2d');
    choices_chart = new Chart(ctx_choices, {
      type: 'bar',
      data: choices_data,
      options: {
        legend: {
          display: false
        },
        title: {
          display: true,
          position: 'top',
          text: title_text,
          fontSize: 14
        },
        scales: {
          yAxes: [{
            ticks: {
              min: 0,
              callback: function(value) {
                return value + "%";
              }
            },
            scaleLabel: {
              display: true,
              labelString: "Percentage"
            }
          }]
        },
        tooltips: {
          enabled: true,
          mode: 'single',
          callbacks: {
            label: function(tooltipItems, data) {
              return ' % who voted for ' + tooltipItems.xLabel + " choices:" + tooltipItems.yLabel;
            }
          }
        }
      }
    });
  </script>

</body>

</html>
