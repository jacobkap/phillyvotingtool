function allowSaveGraph(){var a=myLine.toBase64Image();document.getElementById("time_graph").src=a}function makeGraph(a){election=elections[$(time_election).val()];graph_title="Percent of Votes by Hour";if(time_wards[$("#time_ward").val()]!="All"){graph_title+=" Election, Ward "+time_wards[$("#time_ward").val()]}if($("#time_division").val()!="0"){graph_title+=", Division "+$("#time_division").val()}if($("#cum_sum").is(":checked")){graph_title="Cumulative Total Percent of Votes"}graph_title=election+", "+graph_title;Chart.defaults.global.defaultFontColor="#000000";myLineChart=new Chart(ctx_time,{type:"line",data:{labels:["7-8AM","8-9AM","9-10AM","10-11AM","11AM-12PM","12-1PM","1-2PM","2-3PM","3-4PM","4-5PM","5-6PM","6-7PM","7-8PM"],datasets:[{borderColor:"#000000",fill:false,data:a,onAnimationComplete:allowSaveGraph,}]},options:{legend:{display:false,},title:{display:true,position:"top",text:graph_title,fontSize:22},scales:{yAxes:[{ticks:{beginAtZero:true,fontSize:15},scaleLabel:{fontSize:22,fontColor:"#000000",display:true,labelString:"% of Votes"}}],xAxes:[{ticks:{fontSize:15}}]},responsive:true,tooltips:{mode:"index",intersect:false,},hover:{mode:"nearest",intersect:true}}});return(myLineChart)}function whenClicked(a){ward_num=a.sourceTarget.feature.properties.WARD_NUM;if(a.sourceTarget._mapToAdd._container.id=="results_map_div"){ward_dropdown="#results_ward"}if(a.sourceTarget._mapToAdd._container.id=="choices_map_div"){ward_dropdown="#choices_ward"}if(a.sourceTarget._mapToAdd._container.id=="cand_comb_map_div"){ward_dropdown="#cand_comb_ward"}if(a.sourceTarget._mapToAdd._container.id=="time_map_div"){ward_dropdown="#time_ward"}$(ward_dropdown).val(ward_num);$(ward_dropdown).trigger("chosen:updated");if(a.sourceTarget._mapToAdd._container.id=="results_map_div"){resultsChange()}if(a.sourceTarget._mapToAdd._container.id=="choices_map_div"){choicesChange()}if(a.sourceTarget._mapToAdd._container.id=="time_map_div"){timeChange()}if(a.sourceTarget._mapToAdd._container.id=="cand_comb_map_div"){candCombChange()}}function onEachFeature(b,a){a.on({click:whenClicked})}function makeTable(f,c,d){final_data=c;ward=cand_comb_wards[$("#cand_comb_ward").val()];if(ward!="All"){division=cand_comb_division[$("#cand_comb_division").val()];if(division=="0"){division="All"}final_data=[];for(var a=0;a<c.length;a++){if(c[a].division==division){final_data.push(c[a])}}}final_data=_.map(final_data,function(g){return _.omit(g,"division")});final_data[0][0]="";if(_.keys(final_data[0]).toString()==_.keys(final_data[1]).toString()){final_data.shift()}z=[];d=d.split(",");d=d.filter(function(g){return g!=="division"});final_headers=[];for(var a=0;a<d.length;a++){if(d[a].includes("To Remove")|d[a].includes("V1")){final_headers.push("")}else{final_headers.push(d[a])}}for(var e=0;e<d.length;e++){z.push({data:d[e],title:d[e],})}var b=$(f).DataTable({data:final_data,columns:z,ordering:false,searching:false,bInfo:false,bPaginate:false,bFilter:false,lengthChange:false,scrollX:true,sScrollXInner:"100%",sScrollX:"100%",fixedColumns:{leftColumns:2}});$("#table_wrapper").css("width","100%");return b}function updateTable(){cand_data=getData("cand_comb");cand_data=cand_data.split("\n");cand_data.pop();headers=cand_data[0];cand_data=data_object_fun(cand_data,headers);table.destroy();$("#table").empty();table=makeTable("#table",cand_data,headers);title=cand_comb_offices[$("#cand_comb_ballot_position").val()];if(cand_comb_wards[$("#cand_comb_ward").val()]!="All"){title+=", Ward "+cand_comb_wards[$("#cand_comb_ward").val()]}if(cand_comb_division[$("#cand_comb_division").val()]!="All"){title+=", Division "+cand_comb_division[$("#cand_comb_division").val()]}$("#table_title").text(title)}function updateGraph(){graph.destroy();graph_data=getGraphData();subsetted_graph_data=subsetGraphData(graph_data);graph=makeGraph(subsetted_graph_data);return(graph)}function updateChart(b,a){b.destroy();makeChart(a)}function makeChart(a){Chart.defaults.global.defaultFontColor="#000000";data=getData(a);data=subsetData(data,a);data=formatData(data,a);title_text=data[1];data=data[0];if(a=="choices"){chart_div=ctx_choices;chart_type="bar";choices_chart=new Chart(chart_div,{type:chart_type,data:data,options:{legend:{display:false},title:{display:true,position:"top",text:title_text,fontSize:22},scales:{yAxes:[{ticks:{beginAtZero:true,fontSize:15},scaleLabel:{fontSize:22,display:true,labelString:"% of Votes"}}],xAxes:[{scaleLabel:{fontSize:22,display:true,labelString:"# of Selections Made"},ticks:{fontSize:15}}]},tooltips:{enabled:true,mode:"single",callbacks:{label:function(b,c){return" % who voted for "+b.xLabel+" choices:"+b.yLabel}}}}})}if(a=="results"){chart_type="horizontalBar";chart_div=ctx_results;results_chart=new Chart(chart_div,{type:chart_type,data:data,options:{legend:{display:false},title:{display:true,position:"top",text:title_text,fontSize:22},scales:{xAxes:[{ticks:{beginAtZero:true,fontSize:15,userCallback:function(d,c,b){d=d.toString();d=d.split(/(?=(?:...)*$)/);d=d.join(",");return d}},scaleLabel:{fontSize:20,display:true,labelString:"# of Votes"}}],yAxes:[{ticks:{fontSize:22}}]},tooltips:{enabled:true,mode:"single",callbacks:{label:function(b,c){value=b.xLabel;value=value.toString();value=value.split(/(?=(?:...)*$)/);value=value.join(",");return value}}}}})}};