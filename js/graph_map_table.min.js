function makeGraph(a){graph_title="% of Votes by Hour";if(time_wards[$("#time_ward").val()]!="All"){graph_title+=", Ward "+time_wards[$("#time_ward").val()]}if($("#time_division").val()!="0"){graph_title+=", Division "+$("#time_division").val()}graph=new Dygraph(document.getElementById("time_graph"),a,{title:graph_title,drawGrid:true,independentTicks:true,labelsSeparateLines:true,legend:"always",includeZero:true,ylabel:"% of Voters",xlabel:"Time",visibility:[true],interactionModel:{},colors:["#008837"],strokeWidth:1.5});return(graph)}function whenClicked(a){ward_num=a.sourceTarget.feature.properties.WARD_NUM;if(a.sourceTarget._mapToAdd._container.id=="results_map_div"){ward_dropdown="#results_ward"}if(a.sourceTarget._mapToAdd._container.id=="choices_map_div"){ward_dropdown="#choices_ward"}if(a.sourceTarget._mapToAdd._container.id=="cand_comb_map_div"){ward_dropdown="#cand_comb_ward"}if(a.sourceTarget._mapToAdd._container.id=="time_map_div"){ward_dropdown="#time_ward"}$(ward_dropdown).val(ward_num);$(ward_dropdown).trigger("chosen:updated");if(a.sourceTarget._mapToAdd._container.id=="results_map_div"){resultsChange()}if(a.sourceTarget._mapToAdd._container.id=="choices_map_div"){choicesChange()}if(a.sourceTarget._mapToAdd._container.id=="time_map_div"){timeChange()}if(a.sourceTarget._mapToAdd._container.id=="cand_comb_map_div"){updateTable()}}function onEachFeature(b,a){a.on({click:whenClicked})}function makeTable(e,c){division=cand_comb_division[$("#cand_comb_division").val()];if(division=="0"){division="All"}final_data=[];for(var a=0;a<c.length;a++){if(c[a][0].division==division){final_data.push(c[a])}}final_data=_.map(final_data[0],function(f){return _.omit(f,["division","ward"])});headers=_.keys(final_data[0]);z=[];for(var d=0;d<headers.length;d++){z.push({data:headers[d],})}var b=$(e).DataTable({data:final_data,columns:z,ordering:false,searching:false,bInfo:false,bPaginate:false,bFilter:false,lengthChange:false,scrollX:true,sScrollXInner:"100%",sScrollX:"100%",});return b}function updateTable(){cand_data=getData("cand_comb");table.destroy();$("#table").empty();table=makeTable("#table",cand_data);title=cand_comb_offices[$("#cand_comb_ballot_position").val()];if(cand_comb_wards[$("#cand_comb_ward").val()]!="All"){title+=", Ward "+cand_comb_wards[$("#cand_comb_ward").val()]}if(cand_comb_division[$("#cand_comb_division").val()]!="All"){title+=", Division "+cand_comb_division[$("#cand_comb_division").val()]}$("#table_title").text(title)}function updateGraph(){graph_data=getGraphData();subsetted_graph_data=subsetGraphData(graph_data);graph=makeGraph(subsetted_graph_data);return(graph)}function updateChart(a){data=getData(a);data=subsetData(data,a);data=formatData(data,a);title_text=data[1];data=data[0];if(a=="choices"){chart_div=ctx_choices;chart_type="bar";choices_chart.destroy();choices_chart=new Chart(chart_div,{type:chart_type,data:data,options:{legend:{display:false},title:{display:true,position:"top",text:title_text,fontSize:14},scales:{yAxes:[{ticks:{beginAtZero:true}}]},tooltips:{enabled:true,mode:"single",callbacks:{label:function(b,c){return" % who voted for "+b.xLabel+" choices:"+b.yLabel}}}}})}if(a=="results"){chart_type="horizontalBar";chart_div=ctx_results;results_chart.destroy();results_chart=new Chart(chart_div,{type:chart_type,data:data,options:{legend:{display:false},title:{display:true,position:"top",text:title_text,fontSize:14},scales:{xAxes:[{ticks:{beginAtZero:true},scaleLabel:{display:true,labelString:"# of Votes"}}]},tooltips:{enabled:true,mode:"single",callbacks:{label:function(b,c){return" Votes: "+b.xLabel}}}}})}};