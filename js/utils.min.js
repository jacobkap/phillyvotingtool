function myFunction(){var a=document.getElementById("myTopnav");if(a.className==="topnav"){a.className+=" responsive"}else{a.className="topnav"}}function resizeChosen(){$(".chosen-container").each(function(){$(this).attr("style","width: 95%")})}function setDivisionDropdown(a,c){$(c).empty();temp_division=["All"];ward_num=wards[$(a).val()];if(ward_num!="All"){division_num=_.filter(max_divisions,function(d){return d.ward==ward_num});division_num=division_num[0].max_division;for(var b=1;b<division_num+1;b++){temp_division.push(b)}}$.each(temp_division,function(e,d){$(c).append(new Option(d,e))});$(c).val(0);$(".simple-select").chosen();$(".simple-select").trigger("chosen:updated")}function setOffices(b,a,c){offices=getOffices(b,a);$(c).empty();$.each(offices,function(e,d){$(c).append(new Option(d,e))});$(c).val(0);$(c).trigger("chosen:updated")}function getOffices(b,a){url="https://raw.githubusercontent.com/jacobkap/phillyvotingtool/master/data/";url+=b+"/election_";election=elections[$(a).val()];election=election.toLowerCase().replace(" ","_");election=election.replace(" ","_");url+=election+"/";url+=b+"_office_choices.json";var c=$.getJSON({url:url,type:"get",dataType:"json",async:false,success:function(d){result=d}});c=c.responseJSON;return(c)}function getData(a){folder="election_results";office_dropdown="#results_ballot_position";election_dropdown="#results_election";if(a=="choices"){folder="num_selected";office_dropdown="#choices_ballot_position";election_dropdown="#choices_election"}if(a=="cond_cand"){folder="cond_table";office_dropdown="#cand_comb_ballot_position"}office_options=getOffices(folder,election_dropdown);election=elections[$(election_dropdown).val()];election=election.toLowerCase().replace(" ","_");election=election.replace(" ","_");url="https://raw.githubusercontent.com/jacobkap/phillyvotingtool/master/data/";url+=folder+"/election_";url+=election+"/";url+=folder+"_";url+=office_options[$(office_dropdown).val()];url+=".json";var b=$.getJSON({url:url,type:"get",dataType:"json",async:false,success:function(c){result=c}});b=b.responseJSON;return(b)}function makeGraph(a){graph=new Dygraph(document.getElementById("time_graph"),a,{title:"title",drawGrid:true,independentTicks:true,labelsSeparateLines:true,legend:"always",ylabel:"% of Voters",xlabel:"Hour",visibility:[true],interactionModel:{},colors:["#008837"],strokeWidth:1.3});return(graph)}function resultsElectionChange(){setOffices("election_results","#results_election","#results_ballot_position");resultsChange()}function resultsChange(){setDivisionDropdown("#results_ward","#results_division");updateChart("results")}function choicesChange(){setDivisionDropdown("#choices_ward","#choices_division");updateChart("choices")}function timeChange(){setDivisionDropdown("#time_ward","#time_division");graph=updateGraph()}function updateGraph(){graph_data=getGraphData();subsetted_graph_data=subsetGraphData(graph_data);graph=makeGraph(subsetted_graph_data);return(graph)}function getGraphData(){url="https://raw.githubusercontent.com/jacobkap/phillyvotingtool/master/data/vote_time/election_";election=elections[$("#time_election").val()];election=election.toLowerCase().replace(" ","_");election=election.replace(" ","_");url+=election+"/election_"+election+"_ward_";url+=wards[$("#time_ward").val()];url+="_time.json";var a=$.getJSON({url:url,type:"get",dataType:"json",async:false,success:function(b){result=b}});a=a.responseJSON;return(a)}function subsetData(d,c){var a=[];if(c=="results"){ward=wards[$("#results_ward").val()];division=$("#results_division").val();ward_section=2;division_section=3}else{if(c=="choices"){ward=wards[$("#choices_ward").val()];division=$("#choices_division").val();ward_section=1;division_section=2}}if(division==="0"){division="All"}for(var b=0;b<d[0].length;b++){if(d[ward_section][b]==ward&&d[division_section][b]==division){if(c=="results"){temp=[d[0][b],d[1][b]]}else{if(c=="choices"){temp=[d[0][b],d[3][b]]}}a.push(temp)}}return a}function subsetGraphData(c){var a=[];division=$("#time_division").val();if(division==="0"){division="All"}for(var b=0;b<c[0].length;b++){if(c[3][b]==division){temp=[parseFloat(c[0][b]),parseFloat(c[2][b])];a.push(temp)}}return a}function formatData(b,a){title=all_offices[$("#results_ballot_position").val()];if(wards[$("#results_ward").val()]!="All"){title+=", Ward "+wards[$("#results_ward").val()];title_text=[title]}title_text=[title];if(a=="choices"){title=mult_offices[$("#choices_ballot_position").val()];if(wards[$("#choices_ward").val()]!="All"){title+=", Ward "+wards[$("#choices_ward").val()]}subtitle="Max number of selections: "+mult_offices_choices[$("#choices_ballot_position").val()];title_text=[title,subtitle]}var c={labels:_.map(b,function(d){return d[0]}),datasets:[{data:_.map(b,function(d){return d[1]}),backgroundColor:"rgb(105,105,105)",}]};return[c,title_text]}function updateChart(a){data=getData(a);data=subsetData(data,a);data=formatData(data,a);title_text=data[1];data=data[0];chart_type="horizontalBar";chart_div=ctx_results;if(a=="choices"){chart_div=ctx_choices;chart_type="bar";choices_chart.destroy();choices_chart=new Chart(chart_div,{type:chart_type,data:data,options:{legend:{display:false},title:{display:true,position:"top",text:title_text,fontSize:14},scales:{yAxes:[{ticks:{min:0,callback:function(b){return b+"%"}},scaleLabel:{display:true,labelString:"Percentage"}}],xAxes:[{ticks:{min:0,callback:function(b){return b+"%"}},scaleLabel:{display:true,labelString:"Number of Candidates Voted For"}}]},tooltips:{enabled:true,mode:"single",callbacks:{label:function(b,c){return" % who voted for "+b.xLabel+" choices:"+b.yLabel}}}}})}if(a=="results"){results_chart.destroy();results_chart=new Chart(chart_div,{type:chart_type,data:data,options:{legend:{display:false},title:{display:true,position:"top",text:title_text,fontSize:14},scales:{yAxes:[{ticks:{beginAtZero:true}}]},tooltips:{enabled:true,mode:"single",callbacks:{label:function(b,c){return" Votes: "+b.xLabel}}}}})}}function whenClicked(a){ward_num=a.sourceTarget.feature.properties.WARD_NUM;if(a.sourceTarget._mapToAdd._container.id=="results_map_div"){ward_dropdown="#results_ward"}if(a.sourceTarget._mapToAdd._container.id=="choices_map_div"){ward_dropdown="#choices_ward"}if(a.sourceTarget._mapToAdd._container.id=="cand_comb_map_div"){ward_dropdown="#cand_comb_ward"}if(a.sourceTarget._mapToAdd._container.id=="time_map_div"){ward_dropdown="#time_ward"}$(ward_dropdown).val(ward_num);$(ward_dropdown).trigger("chosen:updated");if(a.sourceTarget._mapToAdd._container.id=="results_map_div"){resultsChange()}if(a.sourceTarget._mapToAdd._container.id=="choices_map_div"){choicesChange()}if(a.sourceTarget._mapToAdd._container.id=="time_map_div"){timeChange()}if(a.sourceTarget._mapToAdd._container.id=="cand_comb_map_div"){updateTable()}}function onEachFeature(b,a){a.on({click:whenClicked})}function makeTable(e,c,d){z=[];for(var a=0;a<d.length;a++){z.push({title:d[a],})}var b=$(e).DataTable({data:c,columns:z,ordering:false,searching:false,bInfo:false,bPaginate:false,bFilter:false,lengthChange:false});return b}function updateTable(){cand_data=getData("cond_cand");table.destroy();$("#table").empty();table=makeTable("#table",cand_data,cand_data[0]);title=all_offices[$("#cand_comb_ballot_position").val()];if(wards[$("#cand_comb_ward").val()]!="All"){title+=", Ward "+wards[$("#cand_comb_ward").val()]}subtitle="Max number of selections: "+mult_offices_choices[$("#cand_comb_ballot_position").val()];$("#table_title").text(title);$("#table_subtitle").text(subtitle)};